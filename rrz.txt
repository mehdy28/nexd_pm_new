    createPrompt: async (
      _parent: any,
      { input }: { input: {
        projectId?: string;
        title: string;
        content?: Block[];
        context?: string;
        description?: string;
        category?: string;
        tags?: string[];
        isPublic?: boolean;
        model?: string;
        variables?: PromptVariable[];
        // 'versions' is no longer used from the input, but we keep it for destructuring
        versions?: any[]; 
      }},
      context: GraphQLContext
    ): Promise<Prompt> => {
      const { content, variables, ...scalarData } = input;

      // Prepare the data for nested creation once to avoid repetition.
      const contentCreateData = content ? content.map((block, index) => ({
        type: block.type,
        value: block.value,
        varId: block.varId,
        placeholder: block.placeholder,
        name: block.name,
        order: index,
      })) : [];
      
      const variablesCreateData = variables ? variables.map(v => {
        const { id, ...rest } = v; // Exclude client-side temporary ID
        return {
          ...rest,
          source: v.source || undefined,
        };
      }) : [];

      // Construct the data payload for Prisma.
      const newPromptData: any = {
        ...scalarData,
        userId: context.user?.id,
        // Create the top-level 'active' content and variables
        content: {
          create: contentCreateData
        },
        variables: {
          create: variablesCreateData
        },
        // Automatically create the first version as a snapshot of the initial state.
        versions: {
          create: [
            {
              notes: "Initial version",
              description: "", // Default description for the first version
              context: input.context || '',
              // Create the content and variables specific to this version
              content: {
                create: contentCreateData,
              },
              variables: {
                create: variablesCreateData,
              },
            },
          ],
        },
      };

      const newPrompt = await prisma.prompt.create({
        data: newPromptData,
        include: {
          content: { orderBy: { order: 'asc' } },
          variables: true,
          // Eagerly load the created version and its nested relations
          // to satisfy the GraphQL query and prevent null errors.
          versions: {
            include: {
              content: { orderBy: { order: 'asc' } },
              variables: true,
            }
          },
        },
      });

      return newPrompt as unknown as Prompt;
    },
