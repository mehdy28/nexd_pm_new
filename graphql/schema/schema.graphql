# ----------------------------------
# Enums
# ----------------------------------

enum SprintStatus {
  PLANNING
  ACTIVE
  COMPLETED
}
enum UserRole {
  ADMIN
  MEMBER
}
enum WorkspaceRole {
  OWNER
  ADMIN
  MEMBER
  GUEST
}
enum ProjectRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}
enum ProjectStatus {
  PLANNING
  ACTIVE
  ON_HOLD
  COMPLETED
  ARCHIVED
  CANCELLED
}
enum TaskStatus {
  TODO
  DONE
}
enum Priority {
  LOW
  MEDIUM
  HIGH
}
enum DependencyType {
  FINISH_TO_START
  START_TO_START
  FINISH_TO_FINISH
  START_TO_FINISH
}
enum Plan {
  FREE
  PRO
  ENTERPRISE
}
enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  PAST_DUE
  UNPAID
}
enum ActivityType {
  TASK_CREATED
  TASK_UPDATED
  TASK_COMPLETED
  TASK_ASSIGNED
  PROJECT_CREATED
  PROJECT_UPDATED
  DOCUMENT_CREATED
  DOCUMENT_UPDATED
  WIREFRAME_CREATED
  WIREFRAME_UPDATED
  COMMENT_ADDED
  MEMBER_ADDED
  MEMBER_REMOVED
  STATUS_UPDATED
  PRIORITY_UPDATED
  DUE_DATE_UPDATED
  POINTS_UPDATED
  DESCRIPTION_UPDATED
  ATTACHMENT_ADDED
  ATTACHMENT_REMOVED
}
enum PromptVariableType {
  STRING
  NUMBER
  BOOLEAN
  DATE
  RICH_TEXT
  LIST_OF_STRINGS
  SELECT
  DYNAMIC
}
enum AggregationType {
  COUNT
  SUM
  AVERAGE
  LIST_FIELD_VALUES
  LAST_UPDATED_FIELD_VALUE
  FIRST_CREATED_FIELD_VALUE
  MOST_COMMON_FIELD_VALUE
}
enum FormatType {
  BULLET_POINTS
  COMMA_SEPARATED
  PLAIN_TEXT
  JSON_ARRAY
}
enum FilterOperator {
  EQ
  NEQ
  GT
  GTE
  LT
  LTE
  CONTAINS
  STARTS_WITH
  ENDS_WITH
  IN_LIST
  NOT_IN
}

# ----------------------------------
# NEW MESSAGING ENUMS
# ----------------------------------
enum ConversationType {
  DIRECT
  GROUP
}
enum TicketStatus {
  OPEN
  IN_PROGRESS
  RESOLVED
  CLOSED
}

# ----------------------------------
# NEW MEMBER MANAGEMENT ENUMS
# ----------------------------------
enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

# ----------------------------------
# Models
# ----------------------------------

type User {
  id: ID!
  email: String!
  firstName: String
  lastName: String
  avatar: String
  firebaseUid: String
  role: UserRole!
  createdAt: DateTime!
  updatedAt: DateTime!
  fullName: String
  workspaceMembers: [WorkspaceMember]
  ownedWorkspaces: [Workspace]
  projectMembers: [ProjectMember]
  assignedTasks: [Task]
  createdTasks: [Task]
  personalTasks: [Task]
  personalDocuments: [Document]
  personalWireframes: [Wireframe]
  personalPrompts: [Prompt]
  personalSections: [PersonalSection]
  activities: [Activity]
  comments: [Comment]
  mentions: [Mention]
  conversations: [Conversation]
  tickets: [Ticket]
}

type Workspace {
  id: ID!
  name: String!
  slug: String!
  description: String
  avatar: String
  plan: Plan!
  createdAt: DateTime!
  updatedAt: DateTime!
  owner: User!
  industry: String
  teamSize: String
  workFields: [String!]
  members: [WorkspaceMember!]!
  projects: [Project!]!
  subscription: Subscription
  settings: WorkspaceSettings
  personalTasks: [Task]
  conversations: [Conversation]
  tickets: [Ticket]
  invitations: [WorkspaceInvitation!]
}

type WorkspaceInvitation {
  id: ID!
  email: String!
  role: WorkspaceRole!
  status: InvitationStatus!
  expiresAt: DateTime!
  createdAt: DateTime!
  invitedBy: UserPartial!
}

type WorkspaceMember {
  id: ID!
  role: WorkspaceRole!
  joinedAt: DateTime!
  workspace: Workspace!
  user: User!
}

type WorkspaceSettings {
  id: ID!
  allowGuestAccess: Boolean!
  timeZone: String!
  workspace: Workspace!
}

type Project {
  id: ID!
  name: String!
  description: String
  color: String!
  status: ProjectStatus!
  startDate: DateTime
  endDate: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
  workspace: Workspace!
  members: [ProjectMember!]!
  tasks: [Task!]!
  documents: [Document!]!
  wireframes: [Wireframe!]!
  prompts: [Prompt!]!
  activities: [Activity!]!
  sprints: [Sprint!]!
  sections: [Section!]!
  projectMemberCount: Int!
  totalTaskCount: Int!
  completedTaskCount: Int!
}

type ProjectMember {
  id: ID!
  role: ProjectRole!
  joinedAt: DateTime!
  project: Project!
  user: User!
}

type Sprint {
  id: ID!
  name: String!
  description: String
  startDate: DateTime!
  endDate: DateTime!
  isCompleted: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  project: Project!
  tasks: [Task!]!
  milestones: [Milestone!]!
  status: SprintStatus!
}

type Milestone {
  id: ID!
  name: String!
  description: String
  dueDate: DateTime!
  isCompleted: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  sprintId: String!
  sprint: Sprint!
}

type Section {
  id: ID!
  name: String!
  order: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  projectId: String!
  project: Project!
  tasks: [Task!]!
}

type PersonalSection {
  id: ID!
  name: String!
  order: Int!
  createdAt: DateTime!
  updatedAt: DateTime!
  user: User!
  tasks: [Task!]!
}

type Task {
  id: ID!
  title: String!
  description: String
  status: TaskStatus!
  priority: Priority!
  dueDate: DateTime
  startDate: DateTime
  endDate: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
  completed: Boolean!
  points: Int
  completionPercentage: Float
  project: Project
  sprint: Sprint
  section: Section
  personalUser: User
  personalWorkspace: Workspace
  personalSection: PersonalSection
  assignee: User
  creator: User!
  parent: Task
  subtasks: [Task!]!
  dependencies: [TaskDependency!]!
  dependents: [TaskDependency!]!
  comments: [Comment!]!
  activities: [Activity!]!
  labels: [TaskLabel!]!
  attachments: [Attachment!]!
  commentCount: Int!
  attachmentCount: Int!
}

type Attachment {
  id: ID!
  publicId: String!
  fileName: String!
  fileType: String!
  fileSize: Int!
  url: String!
  createdAt: DateTime!
  uploader: User!
}

type Label {
  id: ID!
  name: String!
  color: String!
  workspace: Workspace!
  tasks: [TaskLabel!]!
}

type TaskLabel {
  taskId: String!
  labelId: String!
  task: Task!
  label: Label!
}

type Document {
  id: ID!
  title: String!
  content: JSON
  dataUrl: String
  createdAt: DateTime!
  updatedAt: DateTime!
  type: String!
  projectId: ID
  project: Project
  personalUser: User
}

type Wireframe {
  id: ID!
  title: String!
  data: JSON!
  thumbnail: String
  createdAt: DateTime!
  updatedAt: DateTime!
  project: Project
  personalUser: User
  comments: [Comment!]!
  activities: [Activity!]!
}

type WireframeListItem {
  id: ID!
  title: String!
  updatedAt: DateTime!
  thumbnail: String
  projectId: ID
}

type Comment {
  id: ID!
  content: String!
  createdAt: DateTime!
  updatedAt: DateTime!
  author: User!
  task: Task
  document: Document
  wireframe: Wireframe
  prompt: Prompt
  mentions: [Mention!]!
}

type Mention {
  id: ID!
  comment: Comment!
  user: User!
}

type Activity {
  id: ID!
  type: ActivityType!
  data: JSON!
  createdAt: DateTime!
  user: User!
  project: Project
  task: Task
  document: Document
  wireframe: Wireframe
  prompt: Prompt
}

type Subscription {
  id: ID!
  plan: Plan!
  status: SubscriptionStatus!
  currentPeriodEnd: DateTime!
  cancelAtPeriodEnd: Boolean!
  stripeCustomerId: String
  stripeSubscriptionId: String
  createdAt: DateTime!
  updatedAt: DateTime!
  workspace: Workspace!
}

type PromptVariable {
  id: ID!
  name: String!
  placeholder: String!
  description: String
  type: PromptVariableType!
  defaultValue: String
  source: JSON
}

type ContentBlock {
  id: ID!
  type: String!
  value: String
  varId: ID
  placeholder: String
  name: String
}

type Version {
  id: ID!
  content: [ContentBlock!]!
  context: String!
  variables: [PromptVariable!]!
  createdAt: DateTime!
  notes: String
  description: String
}

type Prompt {
  id: ID!
  title: String!
  content: [ContentBlock!]!
  context: String!
  description: String
  category: String
  tags: [String!]!
  isPublic: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  model: String
  projectId: ID
  project: Project
  user: User
  comments: [Comment!]!
  activities: [Activity!]!
  variables: [PromptVariable!]!
  versions: [Version!]!
}

type TaskDependency {
  id: ID!
  type: DependencyType!
  lag: Int!
  precedingTask: Task!
  dependentTask: Task!
}

type WorkspaceData {
  id: ID!
  name: String!
  description: String
  industry: String
  teamSize: String
  workFields: [String!]
  members: [WorkspaceMemberData!]!
  projects: [ProjectData!]!
}

type WorkspaceMemberData {
  id: ID!
  role: WorkspaceRole!
  user: UserPartial!
}

type UserPartial {
  id: ID!
  email: String!
  firstName: String
  lastName: String
}

type WorkspacePartial {
  id: ID!
}

type ProjectData {
  id: ID!
  name: String!
  description: String
  status: ProjectStatus!
  projectMemberCount: Int!
  totalTaskCount: Int!
  completedTaskCount: Int!
}

type ProjectMemberDetails {
  id: ID!
  role: ProjectRole!
  user: UserFullDetails!
}

type GanttTaskData {
  id: ID!
  name: String!
  start: DateTime!
  end: DateTime!
  progress: Int!
  type: String!
  sprint: ID
  personalSectionId: ID
  hideChildren: Boolean
  displayOrder: Int
  description: String
  assignee: UserLookupPartial
  originalTaskId: ID
  originalType: String
}

type GanttDataResponse {
  sprints: [SprintNameId!]!
  tasks: [GanttTaskData!]!
}

type PersonalSectionNameId {
  id: ID!
  name: String!
}

type PersonalGanttDataResponse {
  sections: [PersonalSectionNameId!]!
  tasks: [GanttTaskData!]!
}

type SprintDetails {
  id: ID!
  name: String!
  description: String
  startDate: DateTime!
  endDate: DateTime!
  isCompleted: Boolean!
  status: SprintStatus!
  tasks: [TaskListView!]!
  milestones: [Milestone!]!
}

type ProjectDetails {
  id: ID!
  name: String!
  description: String
  status: ProjectStatus!
  color: String!
  createdAt: DateTime!
  totalTasks: Int!
  completedTasks: Int!
  inProgressTasks: Int!
  overdueTasks: Int!
  upcomingDeadlines: Int!
  displayStatus: String!
  members: [ProjectMemberDetails!]!
  sprints: [SprintDetails!]!
  workspace: WorkspacePartial!
}

type UserFullDetails {
  id: ID!
  email: String!
  firstName: String
  lastName: String
  avatar: String
}

type SprintNameId {
  id: ID!
  name: String!
}

type TaskListView {
  id: ID!
  title: String!
  description: String
  status: TaskStatus!
  priority: Priority!
  dueDate: DateTime
  points: Int
  completionPercentage: Float
  assignee: UserLookupPartial
  completed: Boolean!
  sprintId: ID
  sectionId: ID
  commentCount: Int!
  attachmentCount: Int!
}

type SectionWithTasks {
  id: ID!
  name: String!
  order: Int!
  tasks: [TaskListView!]!
}

type PersonalSectionWithTasks {
  id: ID!
  name: String!
  tasks: [TaskListView!]!
}

type ProjectTasksAndSectionsData {
  sprints: [SprintNameId!]!
  sections: [SectionWithTasks!]!
  projectMembers: [ProjectMemberFullDetails!]!
}

type UserTasksAndSectionsData {
  personalSections: [PersonalSectionWithTasks!]!
}

type ProjectMemberFullDetails {
  id: ID!
  role: ProjectRole!
  user: UserFullDetails!
}

type UserLookupPartial {
  id: ID!
  firstName: String
  lastName: String
  email: String
  avatar: String
}

type ProjectMemberLookupItem {
  id: ID!
  role: ProjectRole!
  user: UserLookupPartial!
}

type SprintLookupItem {
  id: ID!
  name: String!
  status: SprintStatus!
  startDate: DateTime!
  endDate: DateTime!
}

type TaskLookupItem {
  id: ID!
  title: String!
  status: TaskStatus!
  priority: Priority!
  dueDate: DateTime
  assignee: UserLookupPartial
  sprint: SprintNameId
}

type DocumentListItem {
  id: ID!
  title: String!
  updatedAt: DateTime!
  type: String!
  projectId: ID
}

type WorkspaceLookupData {
  id: ID!
  name: String!
  owner: UserLookupPartial!
  members: [WorkspaceMemberLookupItem!]!
}

type WorkspaceMemberLookupItem {
  id: ID!
  role: WorkspaceRole!
  user: UserLookupPartial!
}

type WorkspaceMemberDetails {
  id: ID! # This is the ID of the WorkspaceMember record
  role: WorkspaceRole!
  user: UserLookupPartial!
}

type DocumentsListResponse {
  documents: [DocumentListItem!]!
  totalCount: Int!
}

type WireframesListResponse {
  wireframes: [WireframeListItem!]!
  totalCount: Int!
}

type PromptsListResponse {
  prompts: [PromptListItem!]!
  totalCount: Int!
}

type PromptListItem {
  id: ID!
  title: String!
  description: String
  tags: [String!]!
  updatedAt: DateTime!
  isPublic: Boolean!
  projectId: ID
  model: String
}

# ----------------------------------
# Dashboard Types
# ----------------------------------
type KpiMetrics {
  totalTasks: Int!
  completedTasks: Int!
  inProgressTasks: Int!
  overdueTasks: Int!
  totalPoints: Int!
  completedPoints: Int!
  completionPercentage: Float!
  velocity: Float!
}

type UserKpiMetrics {
  totalTasks: Int!
  completedTasks: Int!
  inProgressTasks: Int!
  overdueTasks: Int!
}

type ChartDataPoint {
  name: String!
  value: Float!
}

type BurnChartDataPoint {
  date: String!
  ideal: Float
  actual: Float
  scope: Float
}

type MemberWorkload {
  assigneeName: String!
  taskCount: Int!
  totalPoints: Int!
  assigneeAvatar: String
  assigneeId: ID!
}

type ProjectDashboardData {
  kpis: KpiMetrics!
  priorityDistribution: [ChartDataPoint!]!
  statusDistribution: [ChartDataPoint!]!
  burnupChart: [BurnChartDataPoint!]!
  burndownChart: [BurnChartDataPoint!]!
  memberWorkload: [MemberWorkload!]!
  sprints: [SprintNameId!]!
}

type UserDashboardData {
  kpis: UserKpiMetrics!
  priorityDistribution: [ChartDataPoint!]!
  statusDistribution: [ChartDataPoint!]!
}

# ----------------------------------
# NEW MESSAGING TYPES
# ----------------------------------
type Conversation {
  id: ID!
  type: ConversationType!
  name: String # For group chats
  participants: [UserLookupPartial!]!
  messages: [Message!]!
  updatedAt: DateTime!
}

type Message {
  id: ID!
  content: String!
  createdAt: DateTime!
  sender: UserLookupPartial!
}

type Ticket {
  id: ID!
  subject: String!
  priority: Priority!
  status: TicketStatus!
  creator: UserLookupPartial!
  messages: [TicketMessage!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type TicketMessage {
  id: ID!
  content: String!
  createdAt: DateTime!
  sender: UserLookupPartial!
  isSupport: Boolean! # To distinguish user vs admin/support replies
}

type CommunicationListItem {
  id: ID!
  type: String! # 'conversation' or 'ticket'
  title: String!
  lastMessage: String
  participantInfo: String!
  updatedAt: DateTime!
  unreadCount: Int!
  priority: Priority # For tickets
  conversationType: ConversationType # For conversations
}

type TypingUser {
  id: ID!
  firstName: String
  lastName: String
}

# ----------------------------------
# Inputs
# ----------------------------------

input WorkspaceInvitationInput {
  email: String!
  role: WorkspaceRole!
}

input ProjectMemberInput {
  userId: ID!
  role: ProjectRole!
}

input DeleteSectionOptions {
  deleteTasks: Boolean!
  reassignToSectionId: ID
}
input CreateProjectTaskInput {
  projectId: ID!
  sectionId: ID!
  title: String!
  description: String
  status: TaskStatus
  priority: Priority
  dueDate: DateTime
  startDate: DateTime
  endDate: DateTime
  assigneeId: ID
  sprintId: ID
  points: Int
  parentId: ID
}
input CreatePersonalTaskInput {
  personalSectionId: ID!
  title: String!
  description: String
  status: TaskStatus
  priority: Priority
  dueDate: DateTime
  startDate: DateTime
  endDate: DateTime
  points: Int
  parentId: ID
}
input UpdateProjectTaskInput {
  id: ID!
  title: String
  description: String
  status: TaskStatus
  priority: Priority
  dueDate: DateTime
  startDate: DateTime
  endDate: DateTime
  assigneeId: ID
  sprintId: ID
  points: Int
  parentId: ID
  isCompleted: Boolean
  sectionId: ID
}
input UpdatePersonalTaskInput {
  id: ID!
  title: String
  description: String
  status: TaskStatus
  priority: Priority
  dueDate: DateTime
  startDate: DateTime
  endDate: DateTime
  points: Int
  parentId: ID
  isCompleted: Boolean
  personalSectionId: ID
}
input CreateSprintInput {
  projectId: ID!
  name: String!
  description: String
  startDate: DateTime!
  endDate: DateTime!
  status: SprintStatus
}
input UpdateSprintInput {
  id: ID!
  name: String
  description: String
  startDate: DateTime
  endDate: DateTime
  isCompleted: Boolean
  status: SprintStatus
}
input CreateWireframeInput {
  projectId: ID!
  title: String!
  data: JSON!
  thumbnail: String
}
input CreatePersonalWireframeInput {
  title: String!
  data: JSON!
  thumbnail: String
}
input UpdateWireframeInput {
  id: ID!
  title: String
  data: JSON
  thumbnail: String
}
input CreateGanttTaskInput {
  projectId: ID!
  sprintId: ID!
  name: String!
  description: String
  startDate: DateTime!
  endDate: DateTime!
  assigneeId: ID
  progress: Int
  type: String!
}
input UpdateGanttTaskInput {
  id: ID!
  type: String!
  name: String
  description: String
  startDate: DateTime
  endDate: DateTime
  assigneeId: ID
  progress: Int
}
input CreatePersonalGanttTaskInput {
  personalSectionId: ID!
  name: String!
  description: String
  startDate: DateTime!
  endDate: DateTime!
  progress: Int
  type: String!
}
input UpdatePersonalGanttTaskInput {
  id: ID!
  type: String!
  name: String
  description: String
  startDate: DateTime
  endDate: DateTime
  progress: Int
}
input CreateDocumentInput {
  projectId: ID!
  title: String!
  content: JSON
  dataUrl: String
}
input CreatePersonalDocumentInput {
  title: String!
  content: JSON
  dataUrl: String
}
input UpdateDocumentInput {
  id: ID!
  title: String
  content: JSON
  dataUrl: String
}
input FilterConditionInput {
  field: String!
  operator: FilterOperator!
  value: JSON
  specialValue: String
  type: PromptVariableType
}
input PromptVariableSourceInput {
  entityType: String!
  field: String
  filter: FilterConditionInput
  aggregation: AggregationType
  aggregationField: String
  format: FormatType
}
input CreatePromptVariableInput {
  id: ID
  name: String!
  placeholder: String!
  description: String
  type: PromptVariableType!
  defaultValue: String
  source: PromptVariableSourceInput
}
input UpdatePromptVariableInput {
  id: ID!
  name: String
  placeholder: String
  description: String
  type: PromptVariableType
  defaultValue: String
  source: PromptVariableSourceInput
}
input CreateContentBlockInput {
  id: ID
  type: String!
  value: String
  varId: ID
  placeholder: String
  name: String
}
input UpdateContentBlockInput {
  id: ID!
  type: String
  value: String
  varId: ID
  placeholder: String
  name: String
}
input CreatePromptInput {
  projectId: ID
  title: String!
  content: [CreateContentBlockInput!]
  context: String
  description: String
  category: String
  tags: [String!]
  isPublic: Boolean
  model: String
  variables: [CreatePromptVariableInput!]
  versions: [CreateVersionInput!]
}
input UpdatePromptInput {
  id: ID!
  title: String
  content: [UpdateContentBlockInput!]
  context: String
  description: String
  category: String
  tags: [String!]
  isPublic: Boolean
  model: String
  variables: [UpdatePromptVariableInput!]
}
input CreateVersionInput {
  id: ID
  content: [CreateContentBlockInput!]!
  context: String!
  variables: [CreatePromptVariableInput!]!
  createdAt: DateTime
  notes: String
  description: String
}
input SnapshotPromptInput {
  promptId: ID!
  notes: String
}
input RestorePromptVersionInput {
  promptId: ID!
  versionId: ID!
}
input UpdateVersionDescriptionInput {
  promptId: ID!
  versionId: ID!
  description: String!
}

type UploadSignatureResponse {
  signature: String!
  timestamp: Int!
  apiKey: String!
  cloudName: String!
}

input ConfirmAttachmentInput {
  publicId: String!
  url: String!
  fileName: String!
  fileType: String!
  fileSize: Int!
  taskId: ID!
}

# ----------------------------------
# NEW MESSAGING INPUTS
# ----------------------------------
input CreateDirectConversationInput {
  workspaceId: ID!
  participantId: ID!
}

input CreateGroupConversationInput {
  workspaceId: ID!
  name: String!
  participantIds: [ID!]!
}

input SendMessageInput {
  conversationId: ID!
  content: String!
}

input CreateTicketInput {
  workspaceId: ID!
  subject: String!
  priority: Priority!
  message: String!
}

input SendTicketMessageInput {
  ticketId: ID!
  content: String!
}


# ----------------------------------
# Root Queries
# ----------------------------------
type Query {
  # General
  me: User
  task(id: ID!): Task
  personalTask(id: ID!): Task

  # Workspace
  getWorkspaceData: WorkspaceData
  getWorkspaceDataLookup(workspaceId: ID!): WorkspaceLookupData

  # Project
  getProjectDetails(projectId: ID!): ProjectDetails
  getGanttData(projectId: ID!, sprintId: ID): GanttDataResponse
  getProjectTasksAndSections(projectId: ID!, sprintId: ID): ProjectTasksAndSectionsData
  getProjectDocuments(projectId: ID!, search: String, skip: Int, take: Int): DocumentsListResponse!
  getDocumentDetails(id: ID!): Document
  getProjectWireframes(projectId: ID!, search: String, skip: Int, take: Int): WireframesListResponse!
  getWireframeDetails(id: ID!): Wireframe
  getProjectPrompts(projectId: ID, skip: Int, take: Int, q: String): PromptsListResponse!
  getPromptDetails(id: ID!): Prompt
  getPromptVersionContent(promptId: ID!, versionId: ID!): Version!
  getProjectSprintsLookup(projectId: ID!): [SprintLookupItem!]!
  getProjectMembersLookup(projectId: ID!): [ProjectMemberLookupItem!]!
  getProjectTasksLookup(projectId: ID!, sprintId: ID): [TaskLookupItem!]!
  getProjectDocumentsLookup(projectId: ID!): [DocumentListItem!]!
  getProjectDashboardData(projectId: ID!, sprintId: ID): ProjectDashboardData

  # User/Personal
  getMyGanttData: PersonalGanttDataResponse
  getMyTasksAndSections: UserTasksAndSectionsData!
  getMyDocuments(search: String, skip: Int, take: Int): DocumentsListResponse!
  getMyWireframes(search: String, skip: Int, take: Int): WireframesListResponse!
  getMyPrompts(skip: Int, take: Int, q: String): PromptsListResponse!
  getMyDashboardData: UserDashboardData!

  # AI/Prompt
  resolvePromptVariable(projectId: ID, workspaceId: ID, variableSource: JSON!, promptVariableId: ID): String

  # Workspace Members
  getWorkspaceMembers(workspaceId: ID!): [WorkspaceMemberDetails!]!

  # NEW: Workspace Invitations
  getWorkspaceInvitations(workspaceId: ID!): [WorkspaceInvitation!]!

  # Messaging
  getCommunicationList(workspaceId: ID!): [CommunicationListItem!]!
  getConversation(id: ID!): Conversation
  getTicket(id: ID!): Ticket
}

# ----------------------------------
# Root Mutations
# ----------------------------------
type Mutation {
  # User & Workspace Setup
  createUser(email: String!, firstName: String, lastName: String, role: UserRole, invitationToken: String): User!
  setupWorkspace(
    userId: ID!
    workspaceName: String!
    workspaceDescription: String
    projectName: String!
    projectDescription: String
    industry: String
    teamSize: String
    workFields: [String!]
  ): Workspace!

  # Project
  createProject(workspaceId: ID!, name: String!, description: String): Project!

  # Project Sections
  createProjectSection(projectId: ID!, name: String!, order: Int): Section!
  updateProjectSection(id: ID!, name: String, order: Int): Section!
  deleteProjectSection(id: ID!, options: DeleteSectionOptions): Section!

  # Personal Sections
  createPersonalSection(name: String!, order: Int): PersonalSection!
  updatePersonalSection(id: ID!, name: String, order: Int): PersonalSection!
  deletePersonalSection(id: ID!, options: DeleteSectionOptions): PersonalSection!

  # Project Tasks
  createProjectTask(input: CreateProjectTaskInput!): TaskListView!
  updateProjectTask(input: UpdateProjectTaskInput!): TaskListView!
  deleteProjectTask(id: ID!): TaskListView!

  # Personal Tasks
  createPersonalTask(input: CreatePersonalTaskInput!): TaskListView!
  updatePersonalTask(input: UpdatePersonalTaskInput!): TaskListView!
  deletePersonalTask(id: ID!): TaskListView!

  # Sprints
  createSprint(input: CreateSprintInput!): SprintDetails!
  updateSprint(input: UpdateSprintInput!): SprintDetails!
  deleteSprint(id: ID!): SprintDetails!

  # Gantt
  createGanttTask(input: CreateGanttTaskInput!): GanttTaskData!
  updateGanttTask(input: UpdateGanttTaskInput!): GanttTaskData!
  createPersonalGanttTask(input: CreatePersonalGanttTaskInput!): GanttTaskData!
  updatePersonalGanttTask(input: UpdatePersonalGanttTaskInput!): GanttTaskData!

  # Documents (Project & Personal)
  createDocument(input: CreateDocumentInput!): DocumentListItem!
  createPersonalDocument(input: CreatePersonalDocumentInput!): DocumentListItem!
  updateDocument(input: UpdateDocumentInput!): DocumentListItem!
  deleteDocument(id: ID!): DocumentListItem!

  # Wireframes (Project & Personal)
  createWireframe(input: CreateWireframeInput!): WireframeListItem!
  createPersonalWireframe(input: CreatePersonalWireframeInput!): WireframeListItem!
  updateWireframe(input: UpdateWireframeInput!): WireframeListItem!
  deleteWireframe(id: ID!): WireframeListItem!

  # Prompts (Project & Personal)
  createPrompt(input: CreatePromptInput!): Prompt!
  updatePrompt(input: UpdatePromptInput!): Prompt!
  deletePrompt(id: ID!): Prompt!
  snapshotPrompt(input: SnapshotPromptInput!): Prompt!
  restorePromptVersion(input: RestorePromptVersionInput!): Prompt!
  updateVersionDescription(input: UpdateVersionDescriptionInput!): Prompt!

  # Comments
  createTaskComment(taskId: ID!, content: String!): Comment!
  deleteTaskComment(id: ID!): Comment!

  # Attachments
  getAttachmentUploadSignature(taskId: ID!): UploadSignatureResponse!
  confirmAttachmentUpload(input: ConfirmAttachmentInput!): Attachment!
  deleteAttachment(id: ID!): Attachment!

  # Messaging
  createDirectConversation(input: CreateDirectConversationInput!): Conversation!
  createGroupConversation(input: CreateGroupConversationInput!): Conversation!
  sendMessage(input: SendMessageInput!): Message!
  markConversationAsRead(conversationId: ID!): Boolean!
  createTicket(input: CreateTicketInput!): Ticket!
  sendTicketMessage(input: SendTicketMessageInput!): TicketMessage!
  updateTicketStatus(ticketId: ID!, status: TicketStatus!): Ticket!
  userIsTyping(conversationId: ID!): Boolean

  # --- NEW MEMBER MANAGEMENT MUTATIONS ---
  inviteWorkspaceMembers(workspaceId: ID!, invitations: [WorkspaceInvitationInput!]!): [WorkspaceInvitation!]!
  revokeWorkspaceInvitation(invitationId: ID!): WorkspaceInvitation!
  resendWorkspaceInvitation(invitationId: ID!): WorkspaceInvitation!
  acceptWorkspaceInvitation(token: String!): WorkspaceMember!
  updateWorkspaceMemberRole(memberId: ID!, role: WorkspaceRole!): WorkspaceMemberDetails!
  removeWorkspaceMembers(memberIds: [ID!]!): [WorkspaceMemberDetails!]!
  addProjectMembers(projectId: ID!, members: [ProjectMemberInput!]!): [ProjectMemberDetails!]!
  updateProjectMemberRole(memberId: ID!, role: ProjectRole!): ProjectMemberDetails!
  removeProjectMembers(memberIds: [ID!]!): [ProjectMemberDetails!]!
}

# ----------------------------------
# NEW REAL-TIME SUBSCRIPTIONS
# ----------------------------------
type Subscription {
  messageAdded(conversationId: ID!): Message
  ticketMessageAdded(ticketId: ID!): TicketMessage
  typingUser(conversationId: ID!): TypingUser
  communicationItemUpdated(workspaceId: ID!): CommunicationListItem
  communicationItemAdded(workspaceId: ID!): CommunicationListItem
}

# ----------------------------------
# Scalars
# ----------------------------------
scalar JSON
scalar DateTime