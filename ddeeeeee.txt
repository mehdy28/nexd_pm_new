    getPromptDetails: async (
      _parent: any,
      { id }: { id: string },
      context: GraphQLContext
    ): Promise<Prompt> => {
      const prompt = await prisma.prompt.findUnique({
        where: { id },
        include: {
          content: {
            orderBy: { order: 'asc' },
          },
          // FIX: Add includes for variables and versions
          variables: true,
          versions: {
            // Only select metadata for the versions list, as per the frontend hook's design
            select: {
              id: true,
              createdAt: true,
              notes: true,
              description: true,
            },
            orderBy: {
              createdAt: 'desc', // Show newest versions first
            }
          },
          user: {
            select: { id: true, firstName: true, lastName: true },
          },
          project: {
            select: { id: true, name: true, workspaceId: true },
          },
        },
      });

      if (!prompt) {
        throw new Error("Prompt not found.");
      }

      // FIX: The logic below is obsolete and incorrect. The top-level prompt is the active state.
      // We remove this entire block. The data fetched above is what should be returned.

      return prompt as unknown as Prompt;
    },
